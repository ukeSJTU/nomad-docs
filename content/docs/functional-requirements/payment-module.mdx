---
title: 3.4 支付功能
description: Payment Module
icon: CreditCard
---

### 3.4.1 模拟支付 (Mock Payment)

#### 1. 功能概述 (Feature Overview)

本功能处理预订流程的最后一步,允许用户对其"待支付"状态的订单,使用一个(为所有用户预设的)虚拟平台余额进行模拟支付。支付成功后,系统会自动更新订单状态,完成整个预订闭环。

#### 2. 优先级 (Priority)

- **MoSCoW 评级:** Must Have

#### 3. 用户故事 (User Stories)

- **US-01 [Must Have]:** 作为一个**已提交订单的用户**,我希望**能使用平台提供的虚拟余额完成支付**,以便**最终确认并锁定我的机票预订**。

#### 4. 验收标准 (Acceptance Criteria)

**场景1: 用户成功支付订单 (Happy Path)**
- **Given** 用户有一个"待支付"状态的订单,且其虚拟余额充足
- **When** 用户在支付页面点击"确认支付"
- **Then** 该订单的状态应在后台更新为"待出行"
- **And** 用户的虚拟余额应(模拟)扣除相应金额
- **And** 用户应被导航至"预订完成"页面,并看到成功提示

**场景2: 用户余额不足**
- **Given** 用户的虚拟余额低于订单总额
- **When** 用户尝试点击"确认支付"
- **Then** 系统应提示"余额不足,支付失败",订单状态保持"待支付"

**场景3: 用户支付超时的订单**
- **Given** 一个"待支付"订单的支付倒计时已结束,订单状态已在后台自动变为"已取消"
- **When** 用户(可能在未刷新的旧页面上)尝试点击"确认支付"
- **Then** 系统应提示"订单已超时取消,无法支付",并引导用户重新预订

#### 5. UI与交互设计简述 (UI/UX Notes)

- **页面布局:**
    - 本功能的UI是 **3.2.3 航班预订** 流程的**第三步**

- **所需UI元素:**
    - 订单总金额显示
    - 支付倒计时组件
    - 支付方式区域(仅显示"平台余额"及可用余额)
    - "确认支付"按钮

- **关键交互:**
    - 点击"确认支付"按钮触发支付流程
    - 支付成功后自动跳转至"预订完成"页面
    - 余额不足或订单超时时显示相应错误提示

---

### 3.4.2 模拟退款 (Mock Refund)

#### 1. 功能概述 (Feature Overview)

本功能允许用户对处于特定状态(如"待出行")的已支付订单发起退款申请。系统将(模拟)处理退款流程,将款项退回用户虚拟余额,并更新订单状态。

#### 2. 优先级 (Priority)

- **MoSCoW 评级:** Should Have

#### 3. 用户故事 (User Stories)

- **US-01 [Should Have]:** 作为一个**因计划有变而无法出行的用户**,我希望**能为我已支付的订单申请退款**,以便**根据航司政策挽回部分损失**。

#### 4. 验收标准 (Acceptance Criteria)

**场景1: 用户成功申请退款 (Happy Path)**
- **Given** 用户有一个状态为"待出行"的订单
- **When** 用户在该订单详情页点击"申请退款"并确认
- **Then** 订单状态应更新为"已退款"
- **And** 用户的虚拟余额应(模拟)增加与订单金额相等的数额

**场景2: 用户对不可退款的订单尝试退款**
- **Given** 用户有一个状态为"已取消"或"待支付"的订单
- **When** 用户访问该订单的详情页
- **Then** 页面上不应显示"申请退款"的按钮

#### 5. UI与交互设计简述 (UI/UX Notes)

- **页面布局:**
    - 在 **3.3.2 订单详情页** 中集成

- **所需UI元素:**
    - "申请退款"按钮(仅当订单状态为"待出行"时显示)
    - 二次确认对话框

- **关键交互:**
    - 点击"申请退款"按钮弹出确认对话框("您确定要申请退款吗?")
    - 确认后触发退款流程,更新订单状态并增加虚拟余额
    - 退款成功后刷新页面显示最新订单状态

---
